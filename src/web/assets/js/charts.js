var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};EntriesIndex=Craft.BaseElementIndex.extend({getViewClass:function(t){switch(t){case"table":return EntriesTableView;default:return this.base(t)}}}),Craft.registerElementIndexClass("roundhouse\\formbuilder\\elements\\Entry",EntriesIndex),EntriesTableView=Craft.TableElementIndexView.extend({startDate:null,endDate:null,startDatepicker:null,endDatepicker:null,$chartExplorer:null,$totalValue:null,$chartContainer:null,$spinner:null,$error:null,$chart:null,$startDate:null,$endDate:null,afterInit:function(){this.$explorerContainer=$('<div class="chart-explorer-container"></div>').prependTo(this.$container),this.createChartExplorer(),this.base()},getStorage:function(t){return EntriesTableView.getStorage(this.elementIndex._namespace,t)},setStorage:function(t,e){EntriesTableView.setStorage(this.elementIndex._namespace,t,e)},createChartExplorer:function(){var t=$('<div class="chart-explorer"></div>').appendTo(this.$explorerContainer),e=$('<div class="chart-header"></div>').appendTo(t),a=$('<div class="date-range" />').appendTo(e),r=$('<div class="datewrapper"></div>').appendTo(a),s=($('<span class="to"><i class="far fa-long-arrow-right"></i></span>').appendTo(a),$('<div class="datewrapper"></div>').appendTo(a)),i=$('<div class="total"></div>').prependTo(e),n=($('<div class="total-label"><p>'+Craft.t("form-builder","Total Submissions")+"</p></div>").appendTo(i),$('<div class="total-value-wrapper"></div>').prependTo(i)),o=$('<span class="total-value">&nbsp;</span>').appendTo(n);this.$chartExplorer=t,this.$totalValue=o,this.$chartContainer=$('<div class="chart-container"></div>').appendTo(t),this.$spinner=$('<div class="loader"><svg width="20px" height="20px" viewBox="0 0 42 42" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff"><g fill="none" fill-rule="evenodd"><g transform="translate(4 3)" stroke-width="5"><circle stroke-opacity=".5" cx="18" cy="18" r="18"/><path d="M36 18c0-9.94-8.06-18-18-18"><animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"/></path></g></g></svg></div>').prependTo(e),this.$error=$('<div class="error"></div>').appendTo(this.$chartContainer),this.$chart=$('<div class="chart"></div>').appendTo(this.$chartContainer),this.$startDate=$('<input type="text" class="text" size="20" autocomplete="off" />').appendTo(r),this.$endDate=$('<input type="text" class="text" size="20" autocomplete="off" />').appendTo(s),this.$startDate.datepicker($.extend({onSelect:$.proxy(this,"handleStartDateChange")},Craft.datepickerOptions)),this.$endDate.datepicker($.extend({onSelect:$.proxy(this,"handleEndDateChange")},Craft.datepickerOptions)),this.startDatepicker=this.$startDate.data("datepicker"),this.endDatepicker=this.$endDate.data("datepicker"),this.addListener(this.$startDate,"keyup","handleStartDateChange"),this.addListener(this.$endDate,"keyup","handleEndDateChange");var l=this.getStorage("startTime")||(new Date).getTime()-2592e6,d=this.getStorage("endTime")||(new Date).getTime();this.setStartDate(new Date(l)),this.setEndDate(new Date(d)),this.loadReport()},handleStartDateChange:function(){this.setStartDate(EntriesTableView.getDateFromDatepickerInstance(this.startDatepicker))&&this.loadReport()},handleEndDateChange:function(){this.setEndDate(EntriesTableView.getDateFromDatepickerInstance(this.endDatepicker))&&this.loadReport()},setStartDate:function(t){return(!this.startDate||t.getTime()!=this.startDate.getTime())&&(this.startDate=t,this.setStorage("startTime",this.startDate.getTime()),this.$startDate.val(Craft.formatDate(this.startDate)),this.endDate&&this.startDate.getTime()>this.endDate.getTime()&&this.setEndDate(new Date(this.startDate.getTime())),!0)},setEndDate:function(t){return(!this.endDate||t.getTime()!=this.endDate.getTime())&&(this.endDate=t,this.setStorage("endTime",this.endDate.getTime()),this.$endDate.val(Craft.formatDate(this.endDate)),this.startDate&&this.endDate.getTime()<this.startDate.getTime()&&this.setStartDate(new Date(this.endDate.getTime())),!0)},loadReport:function(){var t=this.settings.params;t.startDate=EntriesTableView.getDateValue(this.startDate),t.endDate=EntriesTableView.getDateValue(this.endDate),t.formId=this.elementIndex.$source.data("form-id"),this.$spinner.removeClass("hidden"),this.$error.addClass("hidden"),this.$chart.removeClass("error"),Craft.postActionRequest("form-builder/charts/get-entries-count",t,$.proxy(function(t,e){if(this.$spinner.addClass("hidden"),"success"==e&&void 0===t.error){this.chart||(this.chart=new Craft.charts.Area(this.$chart));var a=new Craft.charts.DataTable(t.dataTable),r={orientation:t.orientation,formats:t.formats,dataScale:t.scale,margin:{top:10,right:10,bottom:30,left:10}};this.chart.settings.formats=t.formats,this.chart.draw(a,r),this.$totalValue.html(t.totalHtml)}else{var s=Craft.t("An unknown error occurred.");void 0!==t&&t&&void 0!==t.error&&(s=t.error),this.$error.html(s),this.$error.removeClass("hidden"),this.$chart.addClass("error")}},this))}},{storage:{},getStorage:function(t,e){return EntriesTableView.storage[t]&&EntriesTableView.storage[t][e]?EntriesTableView.storage[t][e]:null},setStorage:function(t,e,a){"undefined"==_typeof(EntriesTableView.storage[t])&&(EntriesTableView.storage[t]={}),EntriesTableView.storage[t][e]=a},getDateFromDatepickerInstance:function(t){return new Date(t.currentYear,t.currentMonth,t.currentDay)},getDateValue:function(t){return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}});