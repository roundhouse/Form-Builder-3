var IntegrationsHud=Garnish.Base.extend({$listContainer:null,$container:null,type:null,hud:null,init:function(t){this.$listContainer=$("#current-integrations-list"),this.$container=$(t.target),this.type=t.type,this.getHud()},handleSubmitted:function(t){$(this.$listContainer[0].children[0]).hasClass("empty")?$("#current-integrations-list").html(t.template):$("#current-integrations-list").append(t.template),this.hud.hide()},getHud:function(){var t={type:this.type};Craft.postActionRequest("form-builder/integrations/get-hud-modal",t,$.proxy(function(t,e){t.success&&this.createHud(t.template)},this))},createHud:function(t){var e=this;this.hud=new Garnish.HUD(this.$container,t,{hudClass:"hud formbuilder-hud",bodyClass:"body",closeOtherHUDs:!1}),this.hud.on("onSubmitted",$.proxy(this,"handleSubmitted")),this.hud.on("hide",$.proxy(function(){delete this.hud,$(".hud-shade").remove(),$(".formbuilder-hud").remove()},this)),this.hud.$body.find("input:first").trigger("focus"),new Craft.HandleGenerator("#integration-name","#integration-handle");var n=this.hud.$footer.find(".cancel");this.addListener(n,"click",function(){this.hud.hide()}),this.hud.on("submit",function(t){var n=e.hud.$body.serialize();Craft.postActionRequest("form-builder/integrations/save",n,$.proxy(function(t,n){t.success?e.handleSubmitted(t):$.each(t.errors,function(t,e){$("#field-"+t).addClass("error")})},this))})}}),IntegrationSelectionHud=Garnish.Base.extend({$container:null,$spinner:null,hud:null,init:function(t){this.$container=$(t),this.createHud()},createHud:function(){var t={type:this.type};$hud=$('<div class="hud-loader-body"/>'),this.$spinner=$('<div class="loader"><svg width="25px" height="25px" viewBox="0 0 42 42" xmlns="http://www.w3.org/2000/svg" stroke="#474747"><g fill="none" fill-rule="evenodd"><g transform="translate(4 3)" stroke-width="5"><circle stroke-opacity=".5" cx="18" cy="18" r="18"/><path d="M36 18c0-9.94-8.06-18-18-18"><animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"/></path></g></g></svg></div>').prependTo($hud),this.hud=new Garnish.HUD(this.$container,$hud,{hudClass:"hud formbuilder-hud",bodyClass:"body",closeOtherHUDs:!1}),Craft.postActionRequest("form-builder/integrations/get-integrations-hud",t,$.proxy(function(t,e){t.success&&this.updateBody(t.template)},this))},updateBody:function(t){var e=this;this.hud.updateBody(t),this.hud.on("onSubmitted",$.proxy(this,"handleSubmitted")),this.hud.on("hide",$.proxy(function(){delete this.hud,$(".hud-shade").remove(),$(".formbuilder-hud").remove()},this)),this.hud.$body.find(".integration-add-link").on("click",function(t){t.preventDefault();var n=$(t.currentTarget),i=n[0].dataset;e.trigger("response",{data:i})})}}),IntegrationItem=Garnish.Base.extend({$container:null,formId:null,id:null,name:null,handle:null,type:null,status:null,init:function(t){this.$container=$("#formbuilder-integrations-container");var e={formId:t.formId,id:t.id,name:t.name,handle:t.handle,type:t.type,status:t.status};this.getIntegrationSection(e)},getIntegrationSection:function(t){Craft.postActionRequest("form-builder/integrations/get-integration-section",t,$.proxy(function(t,e){t.success&&this.appendIntegrationHtml(t)},this))},appendIntegrationHtml:function(t){this.$container.append($(t.template));var e=$("#integration-"+t.type+"-"+t.index);e.find(".option-item").each(function(t,e){new window.Option(e)}),e.find(".delete-btn").on("click",function(t){t.preventDefault(),e.slideUp(300,function(){e.remove()})})}});Garnish.$doc.ready(function(){$(".add-integration").on("click",function(t){t.preventDefault();var e={target:$(this),type:$(this).data("type")};new IntegrationsHud(e)}),$(".add-integrations-item").on("click",function(t){t.preventDefault();var e=$(this).data("form-id");new IntegrationSelectionHud($(this)).on("response",function(t){var n=t.data.type,i=t.data.allowMultiple;t.data.formId=e,t.target.hud.hide(),"1"===i?new IntegrationItem(t.data):$("#integration-"+n+"-1").length>0?Craft.cp.displayError(Craft.t("form-builder","Only 1 integration is allowed for this type")):new IntegrationItem(t.data)})}),$("#formbuilder-integrations-container .delete-btn").on("click",function(t){t.preventDefault();var e=$(this).data("target");$("#"+e).slideUp(300,function(){$("#"+e).remove()})}),$(".item-remove").on("click",function(t){var e=$(this).data("id"),n=$(this).parent(),i={id:e};Craft.postActionRequest("form-builder/integrations/delete",i,$.proxy(function(t,e){t.success?n.velocity("slideUp","300",function(){n.remove(),Craft.cp.displayNotice(Craft.t("form-builder","Integration deleted"))}):Craft.cp.displayNotice(Craft.t("form-builder","Cannot delete integration"))},this))})});