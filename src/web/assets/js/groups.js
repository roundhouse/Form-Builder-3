var GroupItem=void 0,GroupModal=void 0,Groups=void 0;Groups=Garnish.Base.extend({$groups:null,$selectedGroup:null,$newGroupBtn:null,modal:null,init:function(){var t=void 0,o=void 0;this.$groups=$("#groups"),this.$selectedGroup=this.$groups.find("a.sel:first"),this.$newGroupBtn=$("#newgroupbtn"),this.addListener(this.$newGroupBtn,"click","addNewGroup"),t=$("#groupsettingsbtn"),t.length&&(o=t.data("menubtn"),o.settings.onOptionSelect=$.proxy(function(t){switch($(t).data("action")){case"rename":this.renameSelectedGroup();case"delete":this.deleteSelectedGroup()}},this))},addNewGroup:function(){this.modal?this.modal.show():this.modal=new GroupModal(this)},renameSelectedGroup:function(){var t=void 0,o=void 0,e=void 0;e=this.$selectedGroup.text(),(o=this.promptForGroupName(e))&&o!==e&&(t={id:this.$selectedGroup.data("id"),name:o},Craft.postActionRequest("form-builder/groups/save",t,$.proxy(function(t,o){var e=void 0;"success"===o&&(t.success?(this.$selectedGroup.text(t.group.name),Craft.cp.displayNotice(Craft.t("form-builder","Group renamed."))):t.errors?(e=this.flattenErrors(t.errors),alert(Craft.t("form-builder","Could not rename the group:")+"\n\n"+e.join("\n"))):Craft.cp.displayError())},this)))},promptForGroupName:function(t){prompt(Craft.t("form-builder","What do you want to name your group?"),t)},deleteSelectedGroup:function(){var t=void 0;this.$selectedGroup=$("#groups a.sel"),1===this.$selectedGroup.data("id")?Craft.cp.displayError(Craft.t("form-builder","Cannot delete Default group")):confirm(Craft.t("form-builder","Are you sure you want to delete this group and all its forms?"))&&(t={id:this.$selectedGroup.data("id")},Craft.postActionRequest("form-builder/groups/delete",t,$.proxy(function(t,o){"success"===o&&(t.success?location.href=Craft.getUrl("form-builder/forms"):Craft.cp.displayError())},this)))},flattenErrors:function(t){var o=void 0,e=void 0;e=[];for(o in t)e=e.concat(t[o]);return e}}),GroupItem=Garnish.Modal.extend({$groupListItem:null,$group:null,$editGroupBtn:null,id:null,label:null,iconName:null,modal:null,init:function(t){this.$groupListItem=$(t),this.$group=this.$groupListItem.find("a"),this.$editGroupBtn=this.$group.find(".edit-group"),this.id=this.$group.data("id"),this.label=this.$group.data("label"),this.iconName=this.$group.data("icon-name"),this.addListener(this.$editGroupBtn,"click","edit")},edit:function(){this.modal?this.modal.show():this.modal=new GroupModal(this)}}),GroupModal=Garnish.Modal.extend({group:null,$form:null,$modalInputs:null,init:function(t){var o=void 0,e=void 0,r=void 0,i=void 0,s=void 0,n=void 0;this.group=t,this.base(),this.$form=$('<form class="modal fitted formbuilder-modal">').appendTo(Garnish.$bod),this.setContainer(this.$form),n=this.group.id?Craft.t("form-builder","Edit Group"):Craft.t("form-builder","New Group"),r=$(["<header>",'<span class="modal-title">'+n+"</span>","</header>",'<div class="body"><div class="footer-notes">Get icon names at <a href="https://fontawesome.com/icons" target="_blank">FontAwesome</a></div></div>','<footer class="footer">','<div class="buttons">','<input type="button" class="btns btn-modal cancel" value="'+Craft.t("form-builder","Cancel")+'">','<input type="submit" class="btns btn-modal submit" value="'+Craft.t("form-builder","Save")+'">',"</div>","</footer>"].join("")).appendTo(this.$form),s=this.group.label?this.group.label:"",i=this.group.iconName?this.group.iconName:"",o="<input type='text' class='groupName' value='"+s+"' data-hint='NAME' data-name='groupName' />",e="<input type='text' class='groupIcon' value='"+i+"' data-hint='ICON' data-name='groupIcon' />",this.renderInputs(e,"","select","groupIcon","ICON","iconName"),this.renderInputs(o,"","text","groupName","NAME","groupName"),this.show(),this.$saveBtn=r.find(".submit"),this.$cancelBtn=r.find(".cancel"),this.addListener(this.$cancelBtn,"click","hide"),this.addListener(this.$form,"submit","save")},renderInputs:function(t,o,e,r,i,s){var n=void 0;n=$('<div class="fb-field"><div class="input-hint">'+i+"</div>"+t+"</div>"),this.$form.find(".body").prepend(n)},save:function(t){t.preventDefault();var o=void 0,e=void 0,r=void 0,i=void 0;r=this.$form.find(".groupName").val(),e=this.$form.find(".groupIcon").val(),(i=this.$form.find(".groupName").val().length)>0&&(o={id:this.group.id?this.group.id:null,name:r,settings:{icon:{name:e}}},Craft.postActionRequest("form-builder/groups/save",o,$.proxy(function(t,o){var e=void 0;console.log(t),"success"===o&&(t.success?location.href=Craft.getUrl("form-builder/forms"):t.errors?(e=this.flattenErrors(t.errors),alert(Craft.t("form-builder","Could not create the group:")+"\n\n"+e.join("\n"))):Craft.cp.displayError())},this)))},flattenErrors:function(t){var o=void 0,e=void 0;e=[];for(o in t)e=e.concat(t[o]);return e}}),Garnish.$doc.ready(function(){new Groups,$.each($(".group-item"),function(t,o){return new GroupItem(o)})});