var LD_Tabs=void 0;LD_Tabs={setup:function(){}},LD_Tabs=new(Garnish.Base.extend({tabs:null,options:null,init:function(){this.tabs={},this.options={}},setup:function(){var t=void 0,i=void 0,a=void 0,n=void 0;t=this,Craft.FieldLayoutDesigner&&(i=Craft.FieldLayoutDesigner,FLD_init=i.prototype.init,a=i.prototype.initTab,i.prototype.addTab,n=i.prototype.onFieldOptionSelect,i.prototype.init=function(){FLD_init.apply(this,arguments),this.tabEditor=new TabEditor(this)},i.prototype.initTab=function(t){var i=void 0,n=void 0,e=void 0,s=void 0,o=void 0,d=void 0;if(a.apply(this,arguments),t.find(".tab").data("id"))return i=t.find(".tabs .settings"),d=i.data("menubtn"),o=d.menu,e=o.$container,s=e.children("ul"),n=$('<li><a data-action="taboptions">'+Craft.t("form-builder","Options")+"</a></li>").appendTo(s),console.log(),$(['<div class="field-options-preview">',"</div>"].join("")).appendTo(t.find(".tabs")),o.addOptions(n.children("a"))},i.prototype.onTabOptionSelect=function(t){var i=void 0,a=void 0,e=void 0,s=void 0;switch(n.apply(this,arguments),a=$(t),i=a.data("menu").$anchor.parent().parent().parent(),s=a.data("action"),e=i.find(".tab").data("id"),s){case"rename":this.renameTab(i),this.trigger("tabRenamed",{tabId:e});break;case"delete":this.deleteTab(i);break;case"taboptions":this.trigger("tabOptionsSelected",{target:a[0],$target:a,$tab:i,fld:this,tabId:e})}},i.prototype.addTab=function(){return t.addTab(this)})},addTab:function(t){if(t.settings.customizableTabs){var i=$('<div class="fld-tab"><div class="tabs"><div class="tab sel draggable"><span>Fieldset '+(t.tabGrid.$items.length+1)+'</span><a class="settings icon" title="'+Craft.t("app","Rename")+'"></a></div></div><div class="fld-tabcontent"></div></div>').appendTo(t.$tabContainer);t.tabGrid.addItems(i),t.tabDrag.addItems(i),t.initTab(i)}},getOptions:function(t){var i=void 0;return i={},$.each(this.options,function(a,n){parseInt(n.layoutId)==t&&(i[n.tabId]=n.options)}),i}})),TabEditor=Garnish.Base.extend({fld:null,options:null,layoutId:null,namespace:"form-builder",init:function(t){this.fld=t,this.layoutId=LD.getLayoutId(),this.options=LD_Tabs.getOptions(this.layoutId),this.fld.on("tabOptionsSelected",$.proxy(this.openOptionsModal,this)),this.fld.on("tabRenamed",$.proxy(this.onTabRenamed,this)),!1!==this.layoutId&&this.applyOptions(this.layoutId)},applyOptions:function(t){var i=this,a=void 0;if(this.options)return a=[],$.each(this.options,function(t,n){i.options.hasOwnProperty(t)?(options=JSON.parse(i.options[t]),a.push(i.setFormData(t,JSON.parse(n)))):a.push(void 0)}),a},onTabRenamed:function(t){$tab=$(".tab-id-"+t.tabId),$input=$tab.parent().find(".tab-name-field"),$labelSpan=$tab.find("span"),tabName=$labelSpan.text(),$input.val(tabName)},openOptionsModal:function(t){var i=void 0;i=this;var a=void 0,n=void 0,e=t.$tab,s=void 0;s=e.find(".tabs .tab span"),tabName=s.text(),n=t.tabId,a=new TabOptionsModal(e),a.on("setOptions",function(t){return i.setFormData(n,t.options,tabName)}),a.show(this.options)},setFormData:function(t,i,a){var n=void 0,e=void 0,s=void 0;n=this,e=$('[data-id="'+t+'"]').parent(),s=this.namespace+"[tab]["+t+"][options]",$.each(i,function(i,a){e.children('input[name="'+s+"["+i+']"]').length>0?a?(e.children('input[name="'+s+"["+i+']"]').val(a),n.updatePreview(t,e,i,a)):(e.children('input[name="'+s+"["+i+']"]').remove(),n.removePreview(t,e,i,a)):a&&(n.updatePreview(t,e,i,a),$('<input type="hidden" name="'+s+"["+i+']">').val(a).appendTo(e))}),e.find(".tab-name-field").val(a)},updatePreview:function(t,i,a,n){target=$('[data-id="'+t+'"]').parent(),body=target.find(".field-options-preview"),markup=$('<div class="field-'+a+'-preview"><span class="preview-type">'+a+"</span> "+n+"</div>"),oldMarkup=body.find(".field-"+a+"-preview"),oldMarkup&&oldMarkup.remove(),markup.appendTo(body)},removePreview:function(t,i,a,n){target=$('[data-id="'+t+'"]').parent(),target.find(".field-"+a+"-preview").remove()}}),TabOptionsModal=Garnish.Modal.extend({tab:null,form:null,$formContainer:null,init:function(t){var i=void 0;this.tab=t,this.base(),this.$formContainer=$('<form class="modal fitted formbuilder-modal">').appendTo(Garnish.$bod),this.setContainer(this.$formContainer),i=$(["<header>",'<span class="modal-title">',"Attributes","</span>",'<div class="instructions">',"Custom tab attributes","</div>","</header>",'<div class="body">','<div class="fb-field">','<div class="input-hint">',"CLASS","</div>",'<input type="text" class="text fullwidth input-class">',"</div>",'<div class="fb-field">','<div class="input-hint">',"ID","</div>",'<input type="text" class="text fullwidth input-id">',"</div>","</div>",'<footer class="footer">','<div class="buttons">','<input type="button" class="btns btn-modal cancel" value="'+Craft.t("form-builder","Cancel")+'">','<input type="submit" class="btns btn-modal submit" value="'+Craft.t("form-builder","Save")+'">',"</div>","</footer>"].join("")).appendTo(this.$formContainer),this.$inputClass=i.find(".input-class"),this.$inputId=i.find(".input-id"),this.$cancelBtn=i.find(".cancel"),this.loadModalValues(),this.addListener(this.$cancelBtn,"click","hide"),this.addListener(this.$formContainer,"submit","onFormSubmit")},loadModalValues:function(){tabId=this.tab.find(".tab").data("id"),$classInput=$('input[name="form-builder[tab]['+tabId+'][options][class]"]').val(),$idInput=$('input[name="form-builder[tab]['+tabId+'][options][id]"]').val(),$classInput&&this.$formContainer.find(".input-class").val($classInput),$idInput&&this.$formContainer.find(".input-id").val($idInput)},onFormSubmit:function(t){t.preventDefault(),this.visible&&(this.trigger("setOptions",{options:{class:this.$inputClass.val(),id:this.$inputId.val()}}),this.hide())},onFadeOut:function(){this.base(),this.destroy()},destroy:function(){this.base(),this.$container.remove(),this.$shade.remove()},show:function(t){var i=void 0,a=void 0;t.length>0&&(a=JSON.parse(t[this.tab.name])),$.each(a,function(t,a){"class"===t&&a&&i.$inputClass.val(a),"id"===t&&a&&i.$inputId.val(a)}),Garnish.isMobileBrowser()||setTimeout($.proxy(function(){this.$inputClass.focus()},this),100),this.base()}}),window.LD_Tabs=LD_Tabs;