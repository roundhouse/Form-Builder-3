var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},DashboardReportChart=void 0;DashboardReportChart=Garnish.Base.extend({$container:null,$chartExplorer:null,$totalValue:null,$chartContainer:null,$spinner:null,$error:null,$chart:null,params:{startDate:null,endDate:null},init:function(t){this.$container=$(t),this.createChartExplorer(),this.handleMonthChange()},getStorage:function(t){return DashboardReportChart.getStorage(this._namespace,t)},setStorage:function(t,e){DashboardReportChart.setStorage(this._namespace,t,e)},createChartExplorer:function(){var t=$('<div class="chart-explorer"></div>').appendTo(this.$container),e=$('<div class="chart-header"></div>').appendTo(t),a=$('<div class="timeline-wrapper" />').appendTo(e),r=$('<div class="total"></div>').prependTo(e),n=($('<div class="total-label"><p>'+Craft.t("form-builder","Total Submissions")+"</p></div>").appendTo(r),$('<div class="total-value-wrapper"></div>').prependTo(r)),o=$('<span class="total-value">&nbsp;</span>').appendTo(n);this.$chartExplorer=t,this.$totalValue=o,this.$chartContainer=$('<div class="chart-container"></div>').appendTo(t),this.$spinner=$('<div class="loader"><svg width="20px" height="20px" viewBox="0 0 42 42" xmlns="http://www.w3.org/2000/svg" stroke="#E9EFF4"><g fill="none" fill-rule="evenodd"><g transform="translate(4 3)" stroke-width="5"><circle stroke-opacity=".5" cx="18" cy="18" r="18"/><path d="M36 18c0-9.94-8.06-18-18-18"><animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"/></path></g></g></svg></div>').prependTo(e),this.$error=$('<div class="error"></div>').appendTo(this.$chartContainer),this.$chart=$('<div class="chart"></div>').appendTo(this.$chartContainer),this.$monthBtn=$('<button id="month-range" class="active">Last 30 days</buttons>').appendTo(a),this.$weekBtn=$('<button id="week-range">Week</buttons>').appendTo(a),this.addListener(this.$monthBtn,"click","handleMonthChange"),this.addListener(this.$weekBtn,"click","handleWeekChange")},handleMonthChange:function(){this.$weekBtn.removeClass("active"),this.$monthBtn.addClass("active");var t=this.monthRangeDate(),e=new Date((new Date).getTime());this.params.startDate=t,this.params.endDate=e,this.setStorage("startTime",t),this.setStorage("endTime",e),this.loadReport()},handleWeekChange:function(){this.$monthBtn.removeClass("active"),this.$weekBtn.addClass("active");var t=this.weekRangeDate(),e=new Date((new Date).getTime());this.params.startDate=t,this.params.endDate=e,this.setStorage("startTime",t),this.setStorage("endTime",e),this.loadReport()},monthRangeDate:function(){var t=new Date;return new Date((new Date).setDate(t.getDate()-30))},weekRangeDate:function(){var t=new Date((new Date).getTime());return new Date(t.getTime()-6048e5)},loadReport:function(){var t=this.params;t.startDate=this.getDateValue(this.params.startDate),t.endDate=this.getDateValue(this.params.endDate),t.elementType="roundhouse\\formbuilder\\elements\\Entry",this.$spinner.removeClass("hidden"),this.$error.addClass("hidden"),this.$chart.removeClass("error"),Craft.postActionRequest("form-builder/charts/get-entries-count",t,$.proxy(function(t,e){if(this.$spinner.addClass("hidden"),"success"==e&&void 0===t.error){this.chart||(this.chart=new Craft.charts.Area(this.$chart));var a=new Craft.charts.DataTable(t.dataTable),r={orientation:t.orientation,formats:t.formats,dataScale:t.scale,margin:{top:10,right:10,bottom:30,left:10}};this.chart.settings.formats=t.formats,this.chart.draw(a,r),this.$totalValue.html(t.totalHtml)}else{var n=Craft.t("An unknown error occurred.");void 0!==t&&t&&void 0!==t.error&&(n=t.error),this.$error.html(n),this.$error.removeClass("hidden"),this.$chart.addClass("error")}},this))},getDateFromDatepickerInstance:function(t){return new Date(t.currentYear,t.currentMonth,t.currentDay)},getDateValue:function(t){return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}},{storage:{},getStorage:function(t,e){return DashboardReportChart.storage[t]&&DashboardReportChart.storage[t][e]?DashboardReportChart.storage[t][e]:null},setStorage:function(t,e,a){"undefined"==_typeof(DashboardReportChart.storage[t])&&(DashboardReportChart.storage[t]={}),DashboardReportChart.storage[t][e]=a}}),Garnish.$doc.ready(function(){new DashboardReportChart($(".chart-explorer-container"))});