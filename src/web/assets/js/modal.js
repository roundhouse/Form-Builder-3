function isToggler(t){console.log(t)}var OptionModal;window.OptionModal=Garnish.Modal.extend({option:null,$form:null,$modalInputs:null,$redactor:null,$validationItems:[],$togglerInput:null,hasTogglers:!1,errors:[],errorLength:0,init:function(t){var e,i;return i=this,this.option=t,this.base(),this.$form=$('<form class="modal fitted formbuilder-modal">').appendTo(Garnish.$bod),this.setContainer(this.$form),e=$(["<header>",'<span class="modal-title">',t.$data.title,"</span>",'<div class="instructions">',t.$data.instructions,"</div>","</header>",'<div class="body"></div>','<footer class="footer">','<div class="buttons">','<input type="button" class="btns btn-modal cancel" value="'+Craft.t("form-builder","Cancel")+'">','<input type="submit" class="btns btn-modal submit" value="'+Craft.t("form-builder","Save")+'">',"</div>","</footer>"].join("")).appendTo(this.$form),toggler=t.$inputs.some(function(t){return t.toggler}),this.hasTogglers=toggler,$.each(t.$inputs,function(t,e){var a,n,s,o;if(s=e.required?"data-required":"data-not-required",e.toggler&&(i.$togglerInput=e),"checkbox"!==e.type&&!e.toggler)return n=e.name.replace(/[_\W]+/g,"-").slice(0,-1),n.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()}),e.validation&&(o=e.validation,o.passed=!1,o.inputClass=n,i.$validationItems[t]=e),a="textarea"===e.type?"<textarea class='"+n+" "+s+"' value='"+e.value+"' data-hint='"+e.hint+"' data-name='"+e.name+"' "+s+" />"+e.value+"</textarea>":"select"===e.type?$.parseJSON(e.options):"<input type='"+e.type+"' class='"+n+" "+s+"' value='"+e.value+"' data-hint='"+e.hint+"' data-name='"+e.name+"' "+s+" />",i.renderInputs(s,a,e.value,e.type,e.name,e.hint,n)}),this.option.$container.hasClass("has-fields")&&new Fields(this.option,this.$form),this.$modalInputs=this.$form.find(".body").find("input, textarea, select"),this.$togglerInput&&this.activateFieldToggle(),this.show(),this.$saveBtn=e.find(".submit"),this.$cancelBtn=e.find(".cancel"),this.addListener(this.$cancelBtn,"click","cancel"),this.addListener(this.$form,"submit","save")},activateFieldToggle:function(){var t=void 0,e=void 0;t=this.$form.find(".toggle-btn"),this.$togglerInput.value?(e=this.$form.find('[data-selection-target="'+this.$togglerInput.value+'"]'),e.parent().addClass("active-field")):($(t[0]).parent().addClass("active-field"),target=$(t[0]).data("selection-target"),input=$('input[name="'+this.$togglerInput.name+'"]'),input.val(target)),t.on("click",$.proxy(function(e){var i=void 0,a=void 0;t.parent().removeClass("active-field"),this.disableField($(e.target).parent().parent().find("input")),this.disableField($(e.target).parent().parent().find("select")),$(e.target).parent().addClass("active-field"),this.enableField($(e.target).parent().find("input")),this.enableField($(e.target).parent().find("select")),a=$(e.target).data("selection-target"),i=$('input[name="'+this.$togglerInput.name+'"]'),i.val(a)},this))},disableField:function(t){t.prop("disabled",!0),t.val("")},enableField:function(t){t.prop("disabled",!1)},renderInputs:function(t,e,i,a,n,s,o){var r,l;l=this.hasTogglers?"toggle-field":"","select"===a?(r=$('<div class="fb-field '+l+'"><div class="input-hint">'+s+'</div><div class="select input"><select class="'+o+" "+t+'" data-hint="'+s+'" data-name="'+n+'" /></div></div>'),$.each(e,function(t,e){r.find("select").append($("<option>",{value:e.value,text:e.label}))}),r.find("select").val(i)):r=$('<div class="fb-field '+l+'"><div class="input-hint">'+s+'</div><div class="input">'+e+"</div></div>"),this.hasTogglers&&r.append($('<div class="toggle-btn" data-selection-target="'+s.toLowerCase()+'"></div>')),this.$form.find(".body").append(r)},initRedactor:function(t){var e,i;return e=$(t)[0].className,i=this.$form.find("."+e),i.redactor({maxHeight:160,minHeight:150,maxWidth:"400px",buttons:["bold","italic","link","horizontalrule"],plugins:["fontfamily","fontsize","alignment","fontcolor"]}),this.$redactor=i.redactor("core.object")},cancel:function(){return this.option.editing?this.closeModal():(this.option.$edit.addClass("hidden"),this.option.$container.removeClass("option-enabled"),this.option.$resultContainer.html(""),this.option.$toggle.html("ENABLE"),this.disableOption(),this.closeModal())},disableOption:function(){if(this.option.$enableCheckbox)return this.option.$enableCheckbox.prop("checked",!1)},hide:function(){return this.cancel()},closeModal:function(t){return this.disable(),t&&t.stopPropagation(),this.$container&&(this.$container.velocity("fadeOut",{duration:Garnish.FX_DURATION}),this.$shade.velocity("fadeOut",{duration:Garnish.FX_DURATION,complete:$.proxy(this,"onFadeOut")}),this.settings.hideOnShadeClick&&this.removeListener(this.$shade,"click"),this.removeListener(Garnish.$win,"resize")),this.visible=!1,Garnish.Modal.visibleModal=null,this.settings.hideOnEsc&&Garnish.escManager.unregister(this),this.trigger("hide"),this.settings.onHide()},runValidation:function(t){var e;return t.preventDefault(),e=this,this.$validationItems?$.each(this.$validationItems,function(t,i){var a;return a=e.$form.find("."+i.validation.inputClass),a.val().match(/^\d+$/)?i.validation.passed=!0:(i.validation.passed=!1,Craft.cp.displayNotice(i.validation.errorMessage))}):this.save()},save:function(t){var e;t.preventDefault(),e=this,this.option.$container.hasClass("tags")?(this.checkErrors(),this.errors.length>0?($.each(e.errors,function(t,e){$(e).parent().parent().addClass("error")}),Garnish.shake(this.$container)):this.updateOption()):(this.checkErrors(),this.errorLength===this.$modalInputs.length?($.each(e.errors,function(t,e){$(e).is("select"),$(e).parent().parent().addClass("error")}),Garnish.shake(this.$container)):this.updateOption())},checkErrors:function(){var t;t=this,this.errors=[],this.errorLength=0,$.each(this.$modalInputs,function(e,i){$(i).hasClass("data-required")&&""===$(i).val()&&(t.errors[e]=i,t.errorLength+=1)})},updateOption:function(){this.option.updateHtmlFromModal(),this.closeModal(),this.$form[0].reset(),Craft.cp.displayNotice(this.option.$data.successMessage)}});