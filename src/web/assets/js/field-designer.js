var LD_Fields=void 0;LD_Fields={setup:function(){}},LD_Fields=new(Garnish.Base.extend({fields:null,options:null,init:function(){this.fields={},this.options={}},setup:function(){var t=void 0,i=void 0,n=void 0,e=void 0;Craft.FieldLayoutDesigner&&(t=Craft.FieldLayoutDesigner,i=t.prototype.init,n=t.prototype.initField,e=t.prototype.onFieldOptionSelect,t.prototype.init=function(){i.apply(this,arguments),this.fieldEditor=new FieldEditor(this)},t.prototype.initField=function(t){var i=void 0,e=void 0,s=void 0,a=void 0,o=void 0,d=void 0;return n.apply(this,arguments),i=t.find(".settings"),d=i.data("menubtn"),o=d.menu,s=o.$container,a=s.children("ul"),e=$('<li><a data-action="fieldoptions">'+Craft.t("form-builder","Options")+"</a></li>").appendTo(a),$(['<div class="field-options-preview">',"</div>"].join("")).appendTo(t),o.addOptions(e.children("a"))},t.prototype.onFieldOptionSelect=function(t){var i=void 0,n=void 0;switch(e.apply(this,arguments),n=$(t),i=n.data("menu").$anchor.parent(),n.data("action")){case"fieldoptions":this.trigger("fieldOptionsSelected",{target:n[0],$target:n,$field:i,fld:this,id:0|i.data("id")})}})},getOptions:function(t){var i=void 0;return i={},$.each(this.options,function(n,e){parseInt(e.fieldLayoutId)==t&&(i[e.fieldId]=e.options)}),i}})),FieldEditor=Garnish.Base.extend({fld:null,options:null,layoutId:null,namespace:"form-builder",init:function(t){this.fld=t,this.layoutId=LD.getLayoutId(),this.options=LD_Fields.getOptions(this.layoutId),this.fld.on("fieldOptionsSelected",$.proxy(this.openOptionsModal,this)),!1!==this.layoutId&&this.applyOptions(this.layoutId)},applyOptions:function(t){var i=this,n=void 0;if(this.options)return n=[],$.each(this.options,function(t,e){i.options.hasOwnProperty(t)?(options=JSON.parse(i.options[t]),n.push(i.setFormData(t,JSON.parse(e)))):n.push(void 0)}),n},openOptionsModal:function(t){var i=void 0,n=void 0,e=void 0;i=this,n=t.id,e=new FieldOptionsModal(t),e.on("setOptions",function(t){return i.setFormData(n,t.options)}),e.show(this.options)},setFormData:function(t,i){var n=void 0,e=void 0,s=void 0,a=void 0;n=this,e=this.fld.$container,s=e.find('.fld-field[data-id="'+t+'"]:not(".unused")'),a=this.namespace+"[field]["+t+"][options]",$.each(i,function(t,i){s.children('input[name="'+a+"["+t+']"]').length>0?i?(s.children('input[name="'+a+"["+t+']"]').val(i),n.updatePreview(s,t,i)):(s.children('input[name="'+a+"["+t+']"]').remove(),n.removePreview(s,t,i)):i&&(n.updatePreview(s,t,i),$('<input type="hidden" name="'+a+"["+t+']">').val(i).appendTo(s))})},updatePreview:function(t,i,n){body=t.find(".field-options-preview"),markup=$('<div class="field-'+i+'-preview"><span class="preview-type">'+i+"</span> "+n+"</div>"),oldMarkup=body.find(".field-"+i+"-preview"),oldMarkup&&oldMarkup.remove(),markup.appendTo(body)},removePreview:function(t,i,n){t.find(".field-"+i+"-preview").remove()}}),FieldOptionsModal=Garnish.Modal.extend({field:null,$formContainer:null,$classInput:null,$idInput:null,$templateInput:null,init:function(t){var i=void 0;this.field=t,this.base(),this.$formContainer=$('<form class="modal fitted formbuilder-modal has-sidebar">').appendTo(Garnish.$bod),this.setContainer(this.$formContainer),i=$(['<section class="modal-container">','<div class="modal-sidebar">',"<nav>",'<a href="#" class="modal-nav active" data-target="modal-content-styles"><i class="far fa-magic"></i> <span class="link-text">Styles</span></a>','<a href="#" class="modal-nav" data-target="modal-content-settings"><i class="far fa-cog"></i> <span class="link-text">Settings</span></a>',"</nav>","</div>",'<div class="modal-content-container">','<div class="modal-content modal-content-styles active">',"<header>",'<span class="modal-title">',"Attributes","</span>",'<div class="instructions">',"Custom field attributes","</div>","</header>",'<div class="body">','<div class="fb-field">','<div class="input-hint">',"CLASS","</div>",'<input type="text" class="text fullwidth input-class">',"</div>",'<div class="fb-field">','<div class="input-hint">',"ID","</div>",'<input type="text" class="text fullwidth input-id">',"</div>","</div>","</div>",'<div class="modal-content modal-content-settings">',"<header>",'<span class="modal-title">',"Settings","</span>",'<div class="instructions">',"Custom field settings","</div>","</header>",'<div class="body">','<div class="fb-field">','<div class="input-hint">',"TEMPLATE","</div>",'<input type="text" class="text fullwidth input-template">',"</div>","</div>","</div>","</div>","</section>",'<footer class="footer">','<div class="buttons">','<input type="button" class="btns btn-modal cancel" value="'+Craft.t("form-builder","Cancel")+'">','<input type="submit" class="btns btn-modal submit" value="'+Craft.t("form-builder","Save")+'">',"</div>","</footer>"].join("")).appendTo(this.$formContainer),this.$classInput=i.find(".input-class"),this.$idInput=i.find(".input-id"),this.$templateInput=i.find(".input-template"),this.$navLink=i.find(".modal-nav"),this.$cancelBtn=i.find(".cancel"),this.loadModalValues(),this.addListener(this.$cancelBtn,"click","hide"),this.addListener(this.$navLink,"click","toggleModalContent"),this.addListener(this.$formContainer,"submit","onFormSubmit")},loadModalValues:function(){$classInput=$('input[name="form-builder[field]['+this.field.id+'][options][class]"]').val(),$idInput=$('input[name="form-builder[field]['+this.field.id+'][options][id]"]').val(),$templateInput=$('input[name="form-builder[field]['+this.field.id+'][options][template]"]').val(),$classInput&&this.$formContainer.find(".input-class").val($classInput),$idInput&&this.$formContainer.find(".input-id").val($idInput),$templateInput&&this.$formContainer.find(".input-template").val($templateInput)},toggleModalContent:function(t){var i=this;t.preventDefault();var n=void 0,e=void 0,s=void 0;e=$(t.currentTarget),n=e.data("target"),s=$("."+n).height()+53,$(".modal-nav").removeClass("active"),$(".modal-content").removeClass("active"),e.addClass("active"),$("."+n).addClass("active"),this.$container.velocity("stop"),this.$container.velocity({height:s},"fast",function(){i.$container.css({height:s,minHeight:"auto"})})},onFormSubmit:function(t){t.preventDefault(),this.visible&&(this.trigger("setOptions",{options:{class:this.$classInput.val(),id:this.$idInput.val(),template:this.$templateInput.val()}}),this.hide())},onFadeOut:function(){this.base(),this.destroy()},destroy:function(){this.base(),this.$container.remove(),this.$shade.remove()},show:function(t){var i=void 0,n=void 0;i=this,t.length>0&&(n=JSON.parse(t[this.field.id]),$.each(n,function(t,n){"class"==t&&n&&i.$classInput.val(n),"id"==t&&n&&i.$idInput.val(n)}),Garnish.isMobileBrowser()||setTimeout($.proxy(function(){this.$classInput.focus()}))),this.base()}}),window.LD_Fields=LD_Fields;